"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.fromTokenFile = void 0;
var _propertyProvider = require("@smithy/property-provider");
var _fs = require("fs");
var _fromWebToken = require("./fromWebToken");
const ENV_TOKEN_FILE = "AWS_WEB_IDENTITY_TOKEN_FILE";
const ENV_ROLE_ARN = "AWS_ROLE_ARN";
const ENV_ROLE_SESSION_NAME = "AWS_ROLE_SESSION_NAME";
const fromTokenFile = (init = {}) => async () => {
  const webIdentityTokenFile = (init === null || init === void 0 ? void 0 : init.webIdentityTokenFile) ?? process.env[ENV_TOKEN_FILE];
  const roleArn = (init === null || init === void 0 ? void 0 : init.roleArn) ?? process.env[ENV_ROLE_ARN];
  const roleSessionName = (init === null || init === void 0 ? void 0 : init.roleSessionName) ?? process.env[ENV_ROLE_SESSION_NAME];
  if (!webIdentityTokenFile || !roleArn) {
    throw new _propertyProvider.CredentialsProviderError("Web identity configuration not specified");
  }
  return (0, _fromWebToken.fromWebToken)({
    ...init,
    webIdentityToken: (0, _fs.readFileSync)(webIdentityTokenFile, {
      encoding: "ascii"
    }),
    roleArn,
    roleSessionName
  })();
};
exports.fromTokenFile = fromTokenFile;